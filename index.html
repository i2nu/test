<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>도장판 & 증정</title>
<style>
  body {
    font-family: sans-serif;
    background-color: #c5e6e8;
    padding: 10px;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  #leftSection {
    width: 100%;
  }

  #configForm {
    background: #fff;
    padding: 12px 14px;
    border-radius: 10px;
    border: 2px solid #444;
    font-size: 16px;
    box-sizing: border-box;
    margin-bottom: 8px;
  }
  #configForm label {
    display: inline-block;
    width: 130px;
    font-weight: 600;
    font-size: 16px;
  }
  #configForm input[type="number"], #configForm select {
    padding: 6px;
    font-size: 16px;
    margin-right: 6px;
  }
  #configForm input[type="number"] {
    width: 70px;
  }
  #configForm .line {
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  #configForm button.add-btn {
    font-weight: 700;
    padding: 10px 18px;
    cursor: pointer;
    border-radius: 8px;
    border: none;
    background-color: #4a90e2;
    color: white;
    font-size: 17px;
  }
  #configForm button.reset-btn {
    font-weight: 400;
    font-size: 14px;
    color: #888;
    background: none;
    border: none;
    cursor: pointer;
    align-self: center;
  }
  .rewardCountWrapper {
    display: inline-flex;
    align-items: center;
  }
  .rewardCountWrapper span {
    margin-left: 6px;
    font-size: 15px;
  }

  #stampBoardsContainer {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 14px;
    max-height: calc(2 * 160px + 14px);
    overflow-y: auto;
    background: #f9f9f9;
    padding: 10px;
    border-radius: 12px;
    border: 1px solid #bbb;
    margin-bottom: 10px;
  }

  .board-set {
    background: #fff;
    border: 2px solid #444;
    padding: 12px 14px;
    border-radius: 12px;
    display: flex;
    flex-direction: column;
    box-sizing: border-box;
    height: 150px;
  }
  .board-header {
    font-weight: bold;
    margin-bottom: 6px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 16px;
  }
  .delete-btn {
    background: none;
    border: none;
    color: red;
    font-size: 20px;
    cursor: pointer;
    font-weight: bold;
    line-height: 1;
  }

  .stamp-board {
    display: grid;
    gap: 8px;
    margin-top: 4px;
    grid-template-columns: repeat(4, 1fr);
    user-select: none;
    font-size: 14px;
  }
  .stamp {
    background: #fff;
    border: 1px solid #888;
    padding: 6px 6px 8px 6px;
    text-align: center;
    border-radius: 6px;
    font-size: 14px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  .stamp input[type="text"] {
    width: 45px;
    font-size: 14px;
    margin-top: 6px;
    text-align: center;
    padding: 3px 6px;
    border-radius: 4px;
    border: 1px solid #bbb;
  }
  .stamp input[type="checkbox"] {
    transform: scale(1.7);
    margin: 2px 0 0 6px;
    cursor: pointer;
  }
  .stamp-num {
    font-weight: 600;
    font-size: 14px;
    margin-bottom: 3px;
    user-select: none;
  }
  .stamp-top {
    display: flex;
    align-items: center;
    gap: 6px;
    margin-bottom: 4px;
  }
  .stamp.special {
    font-weight: 700;
    color: #222;
  }
  .stamp.special-4 {
    background-color: #fff3b0;
  }
  .stamp.special-8 {
    background-color: #cce5ff;
  }

  #rewardSection {
    width: 100%;
    padding: 4px 6px 10px;
    box-sizing: border-box;
  }
  .section-title {
    font-weight: bold;
    margin: 12px 0 8px;
    font-size: 18px;
  }
  .coupon-board {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 14px;
    margin-bottom: 14px;
  }
  .coupon {
    background: white;
    padding: 8px;
    text-align: center;
    border-radius: 8px;
    font-size: 14px;
  }
  .coupon-type {
    font-weight: bold;
    margin-bottom: 6px;
    font-size: 16px;
    color: #333;
  }
  .coupon input[type="text"] {
    width: 90%;
    font-size: 14px;
    margin-top: 6px;
    text-align: center;
    padding: 6px 8px;
    border-radius: 6px;
    border: 1px solid #bbb;
  }
  .coupon input[type="checkbox"] {
    transform: scale(1.5);
    margin-bottom: 8px;
    cursor: pointer;
  }

  @media (max-width: 768px) {
    body {
      padding: 8px 10px;
    }
    #stampBoardsContainer {
      grid-template-columns: repeat(2, 1fr);
      max-height: calc(2 * 150px + 14px);
      padding: 8px;
    }
    #rewardSection {
      order: 2;
    }
  }
</style>
</head>
<body>

<div id="leftSection">

  <form id="configForm" onsubmit="return false;">
    <div class="line">
      <label for="totalStamps">총 도장 개수</label>
      <input id="totalStamps" type="number" min="1" max="20" value="8" required />
    </div>
    <div class="line">
      <label>증정 시점 1</label>
      <input id="rewardIndex1" type="number" min="1" max="20" value="4" />
      <select id="rewardType1">
        <option value="">없음</option>
        <option value="discount">할인권</option>
        <option value="polaroid">폴라로이드 교환권</option>
        <option value="ost">OST 교환권</option>
        <option value="memory">메모리북</option>
        <option value="etc">기타</option>
      </select>
      <div class="rewardCountWrapper">
        <input id="rewardCount1" type="number" min="1" max="10" value="2" />
        <span>개</span>
      </div>
    </div>
    <div class="line">
      <label>증정 시점 2</label>
      <input id="rewardIndex2" type="number" min="1" max="20" value="8" />
      <select id="rewardType2">
        <option value="">없음</option>
        <option value="discount">할인권</option>
        <option value="polaroid">폴라로이드 교환권</option>
        <option value="ost">OST 교환권</option>
        <option value="memory">메모리북</option>
        <option value="etc">기타</option>
      </select>
      <div class="rewardCountWrapper">
        <input id="rewardCount2" type="number" min="1" max="10" value="1" />
        <span>개</span>
      </div>
    </div>
    <div class="line">
      <label>증정 시점 3</label>
      <input id="rewardIndex3" type="number" min="1" max="20" placeholder="-" />
      <select id="rewardType3">
        <option value="">없음</option>
        <option value="discount">할인권</option>
        <option value="polaroid">폴라로이드 교환권</option>
        <option value="ost">OST 교환권</option>
        <option value="memory">메모리북</option>
        <option value="etc">기타</option>
      </select>
      <div class="rewardCountWrapper">
        <input id="rewardCount3" type="number" min="1" max="10" value="1" />
        <span>개</span>
      </div>
    </div>

    <div id="buttonGroup">
      <button type="button" class="add-btn" onclick="createStampBoard()">도장판 추가</button>
      <button type="button" class="reset-btn" onclick="resetAll()">리셋</button>
    </div>
  </form>

  <div id="stampBoardsContainer">
    <!-- 도장판들이 2열 3행씩 쌓임 -->
  </div>

</div>

<div id="rewardSection">
  <div class="section-title">증정</div>
  <div id="rewardContainer">
    <div id="discountSection" style="display:none;">
      <div class="section-title">할인권</div>
      <div id="discountBoard" class="coupon-board"></div>
    </div>
    <div id="polaroidSection" style="display:none;">
      <div class="section-title">폴라로이드 교환권</div>
      <div id="polaroidBoard" class="coupon-board"></div>
    </div>
    <div id="ostSection" style="display:none;">
      <div class="section-title">OST 교환권</div>
      <div id="ostBoard" class="coupon-board"></div>
    </div>
    <div id="memorySection" style="display:none;">
      <div class="section-title">메모리북</div>
      <div id="memoryBoard" class="coupon-board"></div>
    </div>
    <div id="etcSection" style="display:none;">
      <div class="section-title">기타</div>
      <div id="etcBoard" class="coupon-board"></div>
    </div>
  </div>
</div>

<script>
  let currentBoardId = 0;
  const allBoards = [];

  function resetAll() {
    if(confirm('모든 도장판과 증정 내역을 삭제하시겠습니까?')) {
      allBoards.length = 0;
      document.getElementById('stampBoardsContainer').innerHTML = '';
      clearRewards();
      currentBoardId = 0;
      hideAllRewardSections();
    }
  }

  function clearRewards() {
    ['discountBoard','polaroidBoard','ostBoard','memoryBoard','etcBoard'].forEach(id => {
      document.getElementById(id).innerHTML = '';
    });
  }

  function hideAllRewardSections() {
    ['discountSection','polaroidSection','ostSection','memorySection','etcSection'].forEach(id => {
      document.getElementById(id).style.display = 'none';
    });
  }

  function showRewardSection(type) {
    const map = {
      discount: 'discountSection',
      polaroid: 'polaroidSection',
      ost: 'ostSection',
      memory: 'memorySection',
      etc: 'etcSection',
    };
    if(map[type]) {
      document.getElementById(map[type]).style.display = 'block';
    }
  }

  function deleteBoard(btn) {
    const boardSet = btn.closest('.board-set');
    if(!boardSet) return;
    const id = Number(boardSet.dataset.boardId);
    boardSet.remove();
    const idx = allBoards.findIndex(b => b.id === id);
    if(idx !== -1) allBoards.splice(idx,1);
    updateRewards();
  }

  function createStampBoard() {
    const total = Number(document.getElementById('totalStamps').value);
    if(!total || total < 1 || total > 20) {
      alert('총 도장 개수는 1~20 사이여야 합니다.');
      return;
    }

    let rewards = [];
    for(let i=1; i<=3; i++) {
      const idxRaw = document.getElementById(`rewardIndex${i}`).value.trim();
      const type = document.getElementById(`rewardType${i}`).value;
      const countRaw = document.getElementById(`rewardCount${i}`).value.trim();

      if(idxRaw !== '' && type !== '') {
        const idx = Number(idxRaw);
        if(idx < 1 || idx > total) {
          alert(`증정 시점 ${i}번째 도장 번호가 범위를 벗어났습니다.`);
          return;
        }
        const count = Number(countRaw);
        if(count < 1 || count > 10 || isNaN(count)) {
          alert(`증정 개수는 1~10 사이여야 합니다.`);
          return;
        }
        rewards.push({index: idx, type, count});
      }
    }

    if(rewards.length === 0) {
      alert('최소 한 개 이상의 증정 시점과 보상을 설정해주세요.');
      return;
    }

    currentBoardId++;
    const boardWrap = document.createElement('div');
    boardWrap.className = 'board-set';
    boardWrap.dataset.boardId = currentBoardId;

    const header = document.createElement('div');
    header.className = 'board-header';
    header.innerHTML = `
      <span>도장판 #${currentBoardId}</span>
      <button class="delete-btn" title="삭제" onclick="deleteBoard(this)">×</button>
    `;
    boardWrap.appendChild(header);

    const board = document.createElement('div');
    board.className = 'stamp-board';

    // 도장칸 생성 (총 개수)
    for(let i=1; i<=total; i++) {
      const div = document.createElement('div');
      div.className = 'stamp';

      const rewardObj = rewards.find(r => r.index === i);
      if(rewardObj) {
        div.classList.add('special');
        // 특별 표시 4, 8만 스타일 적용 (기본값)
        if(i === 4) div.classList.add('special-4');
        else if(i === 8) div.classList.add('special-8');
        else div.style.backgroundColor = '#fff3b0';
      }

      div.innerHTML = `
        <div class="stamp-top">
            <span class="stamp-num">${i}</span>
        <input type="checkbox" onchange="updateRewards()" />
        </div>
        <input type="text" placeholder="MM/DD" maxlength="5" oninput="this.value=this.value.replace(/[^0-9\/]/g,'').slice(0,5)" />
        
      `;
      board.appendChild(div);
    }

    boardWrap.appendChild(board);

    // 도장판 추가 (그리드 컨테이너에 추가)
    document.getElementById('stampBoardsContainer').appendChild(boardWrap);

    allBoards.push({ id: currentBoardId, total, rewards, element: boardWrap });

    updateRewards();
  }

  function updateRewards() {
    clearRewards();
    hideAllRewardSections();

    const rewardNames = {
      discount: '할인권',
      polaroid: '폴라로이드 교환권',
      ost: 'OST 교환권',
      memory: '메모리북',
      etc: '기타',
    };

    // 각 증정품별 누적 개수 합산
    let rewardTotals = {
      discount: 0,
      polaroid: 0,
      ost: 0,
      memory: 0,
      etc: 0,
    };

    allBoards.forEach(board => {
      // board.rewards = [{index, type, count}, ...]
      // 체크된 도장 수 세기
      const checkboxes = board.element.querySelectorAll('.stamp input[type="checkbox"]');
      let checkedCount = 0;
      checkboxes.forEach(cb => {
        if(cb.checked) checkedCount++;
      });

      board.rewards.forEach(r => {
        // 체크된 도장이 증정 시점 이상이면 증정품 개수 누적
        if(checkedCount >= r.index) {
          rewardTotals[r.type] += r.count;
        }
      });
    });

    // 증정품별로 표시
    Object.entries(rewardTotals).forEach(([type, total]) => {
      if(total > 0) {
        showRewardSection(type);
        const board = document.getElementById(type + 'Board');
        for(let i=0; i<total; i++) {
          const div = document.createElement('div');
          div.className = 'coupon';

          // 증정권 유형별 input 차이
          let inputHtml = '';
          if(type === 'discount') {
            inputHtml = `<input type="checkbox" /> 사용<br><input type="text" placeholder="MM/DD" maxlength="5" oninput="this.value=this.value.replace(/[^0-9\/]/g,'').slice(0,5)" />`;
          } else if(type === 'polaroid' || type === 'ost' || type === 'memory' || type === 'etc') {
            inputHtml = `<input type="checkbox" /> 사용<br><input type="text" placeholder="이름" />`;
          }

          div.innerHTML = `<div class="coupon-type">${rewardNames[type]}</div>` + inputHtml;

          board.appendChild(div);
        }
      }
    });
  }
</script>

  <!-- HTML 구조 생략, 기존 구조 유지하되 #rewardSection은 stampBoardsContainer 아래에 위치 -->
</body>
</html>
